{% include 'navtrove.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PokeTrove Marketplace</title>
  <link rel="stylesheet" type="text/css" href="{% static 'css/all.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/owl.carousel.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/animate.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/meanmenu.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap">
  <style>
    /* Updated to professional color scheme and typography */
    :root {
      --primary: rgb(37 226 235 / 90%);;
      --primary-dark: #1d4ed8;
      --primary-light: #3b82f6;
      --secondary: #64748b;
      --accent: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;

      --bg-primary: rgba(255, 255, 255, 0.2);
      --bg-secondary: #f8fafc;
      --bg-tertiary: rgba(0, 0, 0, 0.9);
      --bg-card: rgba(255, 255, 255, 0.1);
      --bg-overlay: rgba(0, 0, 0, 0.05);

      --text-primary: rgba(255, 255, 255, 0.8);
      --text-secondary: #00ffe4;
      --text-tertiary: #43ffb7;
      --text-inverse: #ffffff;

      --border-light: rgba(255, 255, 255, 0.2);
      --border-medium: #cbd5e1;
      --border-dark: #94a3b8;

      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 14px;
    }

    /* Professional header styling */
    .professional-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-sm);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-inverse);
      font-weight: 600;
      font-size: 1.125rem;
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.025em;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .search-container {
      position: relative;
      width: 320px;
    }

    .search-input {
      width: 100%;
      padding: 0.5rem 0.75rem 0.5rem 2.5rem;
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: var(--text-tertiary);
    }

    /* Professional container and layout */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 2rem;
    }

    .filter-group {
      margin-bottom: 1.5rem;
    }

    .filter-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .filter-select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      font-size: 0.875rem;
      color: var(--text-primary);
      transition: border-color 0.2s ease;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--primary);
    }

    /* Professional main content area */
    .content-area {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-light);
      overflow: hidden;
    }

    .content-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .content-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .item-count {
      font-size: 0.875rem;
      color: var(--text-secondary);
      background: var(--bg-tertiary);
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
    }

    /* Professional grid layout for items */
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
    }

    .item-card {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-sm);
    }

    .item-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--border-medium);
    }

    .item-image-container {
      position: relative;
      aspect-ratio: 1;
      overflow: hidden;
      background: var(--bg-tertiary);
    }

    .item-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .item-card:hover .item-image {
      transform: scale(1.05);
    }

    .item-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: var(--primary);
      color: var(--text-inverse);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .item-content {
      padding: 1.25rem;
    }

    .item-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      line-height: 1.4;
    }

    .item-subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .item-specs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }

    .spec-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .spec-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .spec-value {
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .price-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .price-current {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--primary);
    }

    .price-old {
      font-size: 0.875rem;
      color: var(--text-tertiary);
      text-decoration: line-through;
    }

    .action-button {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--primary);
      color: var(--text-inverse);
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .action-button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .action-button:active {
      transform: translateY(0);
    }

    /* Professional empty state */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }

    .empty-state img {
      max-width: 200px;
      margin-bottom: 1.5rem;
      opacity: 0.7;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Professional footer */
    .footer {
      background: var(--bg-primary);
      border-top: 1px solid var(--border-light);
      padding: 2rem;
      margin-top: 3rem;
      text-align: center;
    }

    .footer p {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    /* Professional notification system */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: var(--success);
      color: var(--text-inverse);
      padding: 0.75rem 1rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .notification.show {
      transform: translateX(0);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .main-container {
        grid-template-columns: 1fr;
        padding: 1rem;
        gap: 1rem;
      }

      .search-container {
        width: 240px;
      }

      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 1rem;
        padding: 1rem;
      }

      .header-content {
        padding: 0 1rem;
      }
    }
  </style>
</head>

<body>
  <!-- Professional header structure -->

  <!-- Professional main layout -->
  <div class="main-container" style="margin-top: 10%;">
    <aside class="sidebar">
      <h2 class="sidebar-title">Filters</h2>

      <div class="filter-group">
        <label class="filter-label">Category</label>
        <select class="filter-select" id="categoryFilter">
          <option value="all">All Categories</option>
          <option value="pokemon">Pokemon</option>
          <option value="magic">Magic The Gathering</option>
          <option value="yugioh">Yu-Gi-Oh!</option>
          <option value="bakugo">Bakugo</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Condition</label>
        <select class="filter-select" id="conditionFilter">
          <option value="all">All Conditions</option>
          <option value="mint">Mint</option>
          <option value="near-mint">Near Mint</option>
          <option value="excellent">Excellent</option>
          <option value="good">Good</option>
          <option value="fair">Fair</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Price Range</label>
        <select class="filter-select" id="priceFilter">
          <option value="all">All Prices</option>
          <option value="0-25">$0 - $25</option>
          <option value="25-50">$25 - $50</option>
          <option value="50-100">$50 - $100</option>
          <option value="100+">$100+</option>
        </select>
      </div>
    </aside>

    <main class="content-area">
      <div class="content-header">
        <h1 class="content-title">Marketplace</h1>
        <span class="item-count" id="stock-count">{{ Items|length }} items</span>
      </div>

      <section class="items-grid" id="inventoryGrid">
        {% for item in items %}
          <article class="item-card">
            <a href="{{ item.get_absolute_url }}" style="text-decoration: none; color: inherit;">
              <div class="item-image-container">
                <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image">
                <div class="item-badge">Featured</div>
              </div>

              <div class="item-content">
                <h3 class="item-title">{{ item.title }}</h3>
                <p class="item-subtitle">{{ Inventory.choice.choice_text }}</p>

                <div class="item-specs">
                  <div class="spec-item">
                    <span class="spec-label">Condition</span>
                    <span class="spec-value">{{ item.condition }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Category</span>
                    <span class="spec-value">
                      {% if item.category.lower == 'p' %}Pokemon
                      {% elif item.category.lower == 'm' %}Magic The Gathering
                      {% elif item.category.lower == 'b' %}Bakugo
                      {% elif item.category.lower == 'y' %}Yu-Gi-Oh!
                      {% else %}Other{% endif %}
                    </span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Seller</span>
                    <span class="spec-value">
                      {% if item.seller %}{{ item.seller }}{% else %}PokeTrove{% endif %}
                    </span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Tier</span>
                    <span class="spec-value">
                      {% if item.category.lower == 'g' %}Gold
                      {% elif item.category.lower == 'p' %}Platinum
                      {% elif item.category.lower == 'e' %}Emerald
                      {% else %}Diamond{% endif %}
                    </span>
                  </div>
                </div>

                <div class="price-section">
                  <div>
                    {% if item.price %}
                      {% if item.discount_price %}
                        <span class="price-old">${{ item.price }}</span>
                        <div class="price-current">${{ item.discount_price }}</div>
                      {% else %}
                        <div class="price-current">${{ item.price }}</div>
                      {% endif %}
                    {% else %}
                      {% if item.discount_currency_price %}
                        <span class="price-old">💎 {{ item.currency_price }}</span>
                        <div class="price-current">💎 {{ item.discount_currency_price }}</div>
                      {% else %}
                        <div class="price-current">💎 {{ item.currency_price }}</div>
                      {% endif %}
                    {% endif %}
                  </div>
                </div>

                <button class="action-button add-to-cart-btn" onclick="addToCart(this, event)">
                  Add to Cart
                </button>
              </div>
            </a>
          </article>
        {% empty %}
          <div class="empty-state">
            <img src="{% static 'css/images/broke.gif' %}" alt="No items">
            <h3>No items available</h3>
            <p>Check back later for new arrivals!</p>
          </div>
        {% endfor %}
      </section>
    </main>
  </div>

  <footer class="footer">
    <div class="container">
      <p>
        {% for BaseCopyrightTextField in BaseCopyrightTextFielded %}
          {{ BaseCopyrightTextField.copyright }}
        {% endfor %}
      </p>
    </div>
  </footer>

  <script>
    const sellAudio = new Audio("{% static 'css/sounds/sell_coin.mp3' %}");
    const withdrawAudio = new Audio("{% static 'css/sounds/withdraw.mp3' %}");
    const tradeAudio = new Audio("{% static 'css/sounds/trade.mp3' %}");

    // Preload audio files
    [sellAudio, withdrawAudio, tradeAudio].forEach(audio => {
      audio.preload = 'auto';
      audio.volume = 0.3;
    });

    document.addEventListener("DOMContentLoaded", function() {
      initializeFilters();
      initializeSearch();
      initializeCartButtons();
    });

    function initializeFilters() {
      const categoryFilter = document.getElementById('categoryFilter');
      const conditionFilter = document.getElementById('conditionFilter');
      const priceFilter = document.getElementById('priceFilter');

      [categoryFilter, conditionFilter, priceFilter].forEach(filter => {
        if (filter) {
          filter.addEventListener('change', applyFilters);
        }
      });
    }

    function initializeSearch() {
      const searchInput = document.querySelector('.search-input');
      if (searchInput) {
        searchInput.addEventListener('input', debounce(handleSearch, 300));
      }
    }

    function initializeCartButtons() {
      const addToCartBtns = document.querySelectorAll('.add-to-cart-btn');
      addToCartBtns.forEach(btn => {
        btn.addEventListener('click', handleAddToCart);
      });
    }

    function handleAddToCart(event) {
      event.preventDefault();
      event.stopPropagation();

      try {
        tradeAudio.play().catch(e => console.log('Audio play failed:', e));
        showNotification('Item added to cart successfully!');

        // Add visual feedback
        this.style.background = 'var(--success)';
        this.textContent = 'Added!';

        setTimeout(() => {
          this.style.background = 'var(--primary)';
          this.textContent = 'Add to Cart';
        }, 2000);

      } catch (error) {
        console.error('Error adding to cart:', error);
        showNotification('Error adding item to cart', 'error');
      }
    }

    function applyFilters() {
      const category = document.getElementById('categoryFilter')?.value || 'all';
      const condition = document.getElementById('conditionFilter')?.value || 'all';
      const price = document.getElementById('priceFilter')?.value || 'all';

      const items = document.querySelectorAll('.item-card');
      let visibleCount = 0;

      items.forEach(item => {
        let show = true;

        // Apply category filter
        if (category !== 'all') {
          const itemCategory = item.querySelector('.spec-value')?.textContent?.toLowerCase();
          if (!itemCategory?.includes(category)) {
            show = false;
          }
        }

        // Apply condition filter
        if (condition !== 'all' && show) {
          const itemCondition = item.querySelector('.spec-value')?.textContent?.toLowerCase();
          if (!itemCondition?.includes(condition)) {
            show = false;
          }
        }

        item.style.display = show ? 'block' : 'none';
        if (show) visibleCount++;
      });

      // Update count
      const stockCount = document.getElementById('stock-count');
      if (stockCount) {
        stockCount.textContent = `${visibleCount} items`;
      }
    }

    function handleSearch(event) {
      const query = event.target.value.toLowerCase();
      const items = document.querySelectorAll('.item-card');
      let visibleCount = 0;

      items.forEach(item => {
        const title = item.querySelector('.item-title')?.textContent?.toLowerCase() || '';
        const subtitle = item.querySelector('.item-subtitle')?.textContent?.toLowerCase() || '';
        const show = title.includes(query) || subtitle.includes(query);

        item.style.display = show ? 'block' : 'none';
        if (show) visibleCount++;
      });

      const stockCount = document.getElementById('stock-count');
      if (stockCount) {
        stockCount.textContent = `${visibleCount} items`;
      }
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;

      if (type === 'error') {
        notification.style.background = 'var(--error)';
      }

      document.body.appendChild(notification);

      setTimeout(() => notification.classList.add('show'), 10);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function handleFormSubmission(form) {
      const formData = new FormData(form);
      const url = form.getAttribute('action');

      fetch(url, {
        method: 'POST',
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value,
        },
        body: formData,
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('stock-count').textContent = `${data.stock_count} items`;
          form.closest('.item-card')?.remove();

          if (form.classList.contains('sell-form')) {
            sellAudio.play().catch(e => console.log('Audio play failed:', e));
          } else if (form.classList.contains('withdraw-form')) {
            withdrawAudio.play().catch(e => console.log('Audio play failed:', e));
          }

          showNotification('Action completed successfully!');
        } else {
          showNotification('Action failed. Please try again.', 'error');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showNotification('Network error. Please try again.', 'error');
      });
    }
  </script>

  <script src="{% static 'css/js/jquery-1.11.3.min.js' %}"></script>
  <script src="{% static 'css/js/main.js' %}"></script>
  <script src="{% static 'css/js/css/bootstrapper.min.js' %}"></script>
  <script src="{% static 'css/js/jquery.countdown.js' %}"></script>
  <script src="{% static 'css/js/jquery.isotope-3.0.6.min.js' %}"></script>
  <script src="{% static 'css/js/waypoints.js' %}"></script>
  <script src="{% static 'css/js/jquery.magnific-popup.min.js' %}"></script>
  <script src="{% static 'css/js/owl.carousel.min.js' %}"></script>
  <script src="{% static 'css/js/jquery.meanmenu.min.js' %}"></script>
  <script src="{% static 'css/js/sticker.js' %}"></script>
</body>
</html>
